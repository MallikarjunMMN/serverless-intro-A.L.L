<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>serverless thang</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://npmcdn.com/babel-core@5.8.38/browser.min.js"></script>
    <script type="text/babel">

      let catCount = 0;

      const addCat = (catName, callBack) => {
        fetch('https://po4m3psh3d.execute-api.us-east-1.amazonaws.com/prod/CatDBManager', {
          method: "POST",
          mode: 'cors',
          body: "{\"operation\":\"create\",\"tableName\":\"CatTable\",\"payload\":{\"Item\":{\"Id\":\"" + (catCount + 1).toString() + "\",\"name\":\"" + catName + "\"}}}"
        })
        .then(
          (response) => {
            return response.json()
          }
        )
        .then(
          (data) => {
            console.log('drop the bass')
            callBack(data)
            $( "#cats" ).empty();
            getCats(catBack)
          }
        )
        .catch(
          (err) => {
            console.log("'Tis erroneous, Sire: ", err)
          }
        )
      };

      const getCats = (callBack) => {
        fetch('https://po4m3psh3d.execute-api.us-east-1.amazonaws.com/prod/CatDBManager', {
          method: "POST",
          mode: 'cors',
          body: "{\"operation\":\"list\",\"tableName\":\"CatTable\",\"payload\":{}}"
        })
        .then(
          (response) => {
            return response.json()
          }
        )
        .then(
          (data) => {
            console.log('drop the bass')
            callBack(data)
          }
        )
        .catch(
          (err) => {
            console.log("'Tis erroneous, Sire: ", err)
          }
        )
      };

      const callback = (data) => {
        console.log(data)
      };

      const catBack = (data) => {
        let cats = data.Items;

        let theCatNames = [];
        cats.map( (cat, i) => {
          theCatNames.push(cats[i].name);
        })
        theCatNames.forEach( (name) => {
          catCount += 1;
          $('#cats').append(name + '<br>');
        })
        console.log('catCount: ', catCount);
      };

      $(document).ready( () => {
        $("#newName").submit( (event) => {
          event.preventDefault();
          addCat(event.target.name.value, callback);
        });

        getCats(catBack);
      });
      
    </script>
  </head>
  <body>
    <form  id="newName">
      Please provide a cat name:<input type="text" name="name">
      <input type="submit">
    </form>
    <h3>Cat Names:</h3>
    <div id='cats'></div>
  </body>
</html>
